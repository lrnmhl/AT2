%%%% SHORTCUTS %%%%

%$$$% Deprecated!!! %$$$%
\DeclareMathOperator*{\limit}{lim}
\DeclareMathOperator*{\colimit}{colim}
\DeclareMathOperator*{\hocolimit}{hocolim}
\DeclareMathOperator*{\holimit}{holim}
%$$$%%$$$%%$$$%%$$$%%$$$%

\newcommand{\steq}{\operatorname{steq}}
\newcommand{\Sp}{\cat{Sp}}
\newcommand{\Vect}{\cat{Vect}}
\newcommand{\orth}{\perp}
\DeclareMathOperator{\sh}{sh}
\DeclareMathOperator{\Thom}{Thom}
\newcommand{\Or}{\boldsymbol{\mathrm{O}}}
\newcommand{\op}{{\operatorname{op}}}
\newcommand{\cofib}{\rightarrowtail}
\newcommand{\Ob}{\operatorname{Ob}}
\newcommand{\tailto}{\rightarrowtail}
\newcommand{\tto}{\tailto}
\usepackage{stackengine}
\newcommand\xtto[2][]{\ensurestackMath{\mathrel{%
  \stackengine{1pt}{%
    \stackengine{0pt}{\rightarrowtail}{\scriptstyle#2}{O}{c}{F}{F}{S}%
  }{\scriptstyle#1}{U}{c}{F}{F}{S}%
}}}
\newcommand{\acco}{\xtto{\sim}}
\newcommand{\bs}{\backslash}
\newcommand{\SH}{\Ss\Hh}
\newcommand{\Cof}{\operatorname{Cof}}
\newcommand{\ts}{\textstyle}
\newcommand{\ds}{\displaystyle}
\newcommand{\RMod}{{}_{R\!}\Mod(\Sp)}
\newcommand{\Ch}{\operatorname{Ch}}
\newcommand{\tprod}{\ts\prod}
\newcommand{\tcoprod}{\ts\coprod}
\newcommand{\tsum}{\ts\sum}
\newcommand{\from}{\leftarrow}
\newcommand{\xfrom}{\xleftarrow{}}

\makeatletter
\newcommand{\changeoperator}[1]{%
  \csletcs{#1@saved}{#1@}%
  \csdef{#1@}{\changed@operator{#1}}%
}
\newcommand{\changed@operator}[1]{%
  \mathop{%
    \mathchoice{\textstyle\csuse{#1@saved}}
               {\csuse{#1@saved}}
               {\csuse{#1@saved}}
               {\csuse{#1@saved}}%
  }%
}
\makeatother

\changeoperator{sum}
\changeoperator{prod}
\changeoperator{coprod}
\changeoperator{bigoplus}
\changeoperator{bigvee}
\changeoperator{bigwedge}

\renewcommand{\ge}{\geq}
\renewcommand{\le}{\leq}

%%%% general %%%%
\newcommand{\comment}[1]{}
\newcommand{\finish}{\todo[inline,color=red]{finish!}\bigskip}


%%%% many alphabets %%%%

% greek
\let\dumbphi\phi
\let\phi\varphi
\let\dumbepsilon\epsilon
\let\epsilon\varepsilon
\renewcommand{\varphi}{\dumbphi}
\renewcommand{\varepsilon}{\dumbepsilon}

% mathcal (Aa)
\newcommand{\Aa}{\mathcal{A}}
\newcommand{\Bb}{\mathcal{B}}
\newcommand{\Cc}{\mathcal{C}}
\newcommand{\Dd}{\mathcal{D}}
\newcommand{\Ee}{\mathcal{E}}
\newcommand{\Ff}{\mathcal{F}}
\newcommand{\Gg}{\mathcal{G}}
\newcommand{\Hh}{\mathcal{H}}
\newcommand{\Ii}{\mathcal{I}}
\newcommand{\Jj}{\mathcal{J}}
\newcommand{\Kk}{\mathcal{K}}
\newcommand{\Ll}{\mathcal{L}}
\newcommand{\Mm}{\mathcal{M}}
\newcommand{\Nn}{\mathcal{N}}
\newcommand{\Oo}{\mathcal{O}}
\newcommand{\Pp}{\mathcal{P}}
\newcommand{\Qq}{\mathcal{Q}}
\newcommand{\Rr}{\mathcal{R}}
\newcommand{\Ss}{\mathcal{S}}
\newcommand{\T}{\mathcal{T}}
\newcommand{\Uu}{\mathcal{U}}
\newcommand{\Vv}{\mathcal{V}}
\newcommand{\Ww}{\mathcal{W}}
\newcommand{\Xx}{\mathcal{X}}
\newcommand{\Yy}{\mathcal{Y}}
\newcommand{\Zz}{\mathcal{Z}}

% mathbb (AA)
\renewcommand{\AA}{\mathbb{A}}
\newcommand{\BB}{\mathbb{B}}
\newcommand{\CC}{\mathbb{C}}
\newcommand{\DD}{\mathbb{D}}
\newcommand{\EE}{\mathbb{E}}
\newcommand{\FF}{\mathbb{F}}
\newcommand{\GG}{\mathbb{G}}
\newcommand{\HH}{\mathbb{H}}
\newcommand{\II}{\mathbb{I}}
\newcommand{\JJ}{\mathbb{J}}
\newcommand{\KK}{\mathbb{K}}
\newcommand{\LL}{\mathbb{L}}
\newcommand{\MM}{\mathbb{M}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\OO}{\mathbb{O}}
\newcommand{\PP}{\mathbb{P}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\RR}{\mathbb{R}}
\renewcommand{\SS}{\mathbb{S}} %(capital Eszett)
\newcommand{\TT}{\mathbb{T}}
\newcommand{\UU}{\mathbb{U}}
\newcommand{\VV}{\mathbb{V}}
\newcommand{\WW}{\mathbb{W}}
\newcommand{\XX}{\mathbb{X}}
\newcommand{\YY}{\mathbb{Y}}
\newcommand{\ZZ}{\mathbb{Z}}

% mathfrak (xA/aa)
\newcommand{\xA}{\mathfrak{A}}
\newcommand{\xB}{\mathfrak{B}}
\newcommand{\xC}{\mathfrak{C}}
\newcommand{\xD}{\mathfrak{D}}
\newcommand{\xE}{\mathfrak{E}}
\newcommand{\xF}{\mathfrak{F}}
\newcommand{\xG}{\mathfrak{G}}
\newcommand{\xH}{\mathfrak{H}}
\newcommand{\xI}{\mathfrak{I}}
\newcommand{\xJ}{\mathfrak{J}}
\newcommand{\xK}{\mathfrak{K}}
\newcommand{\xL}{\mathfrak{L}}
\newcommand{\xM}{\mathfrak{M}}
\newcommand{\xN}{\mathfrak{N}}
\newcommand{\xO}{\mathfrak{O}}
\newcommand{\xP}{\mathfrak{P}}
\newcommand{\xQ}{\mathfrak{Q}}
\newcommand{\xR}{\mathfrak{R}}
\newcommand{\xS}{\mathfrak{S}}
\newcommand{\xT}{\mathfrak{T}}
\newcommand{\xU}{\mathfrak{U}}
\newcommand{\xV}{\mathfrak{V}}
\newcommand{\xW}{\mathfrak{W}}
\newcommand{\xX}{\mathfrak{X}}
\newcommand{\xY}{\mathfrak{Y}}
\newcommand{\xZ}{\mathfrak{Z}}

\renewcommand{\aa}{\mathfrak{a}}
\newcommand{\bb}{\mathfrak{b}}
\newcommand{\cc}{\mathfrak{c}}
\newcommand{\dd}{\mathfrak{d}}
\newcommand{\ee}{\mathfrak{e}}
\newcommand{\ff}{\mathfrak{f}}
%\let\ggs\gg
%\renewcommand{\gg}{\mathfrak{g}}
\newcommand{\hh}{\mathfrak{h}}
\newcommand{\ii}{\mathfrak{i}}
\newcommand{\jj}{\mathfrak{j}}
\newcommand{\kk}{\mathfrak{k}}
%\let\lls\ll
%\renewcommand{\ll}{\mathfrak{l}}
\newcommand{\mm}{\mathfrak{m}}
%\renewcommand{\nn}{\mathfrak{n}}
\newcommand{\oo}{\mathfrak{o}}
\newcommand{\pp}{\mathfrak{p}}
\newcommand{\qq}{\mathfrak{q}}
\newcommand{\rr}{\mathfrak{r}}
%\renewcommand{\ss}{\mathfrak{s}}
%\renewcommand{\tt}{\mathfrak{t}}
\newcommand{\uu}{\mathfrak{u}}
\newcommand{\vv}{\mathfrak{v}}
\newcommand{\ww}{\mathfrak{w}}
\newcommand{\xx}{\mathfrak{x}}
\newcommand{\yy}{\mathfrak{y}}
\newcommand{\zz}{\mathfrak{z}}


%%%% math %%%%

% core
\newcommand{\N}{{\mathbb N}}
\newcommand{\Z}{{\mathbb Z}}
\newcommand{\Q}{{\mathbb Q}}
\newcommand{\R}{{\mathbb R}}
%% CC already defined
%% HH already defined
%% OO already defined
\newcommand{\I}{{\mathcal I}}
\newcommand{\J}{{\mathcal J}}
%\renewcommand{\P}{{\mathcal P}} %!
\renewcommand{\O}{{\mathcal O}} %!

\newcommand{\rpn}{{\R\mathbf{P}^n}}
\newcommand{\cpn}{{\CC\mathbf{P}^n}}
\newcommand{\hpn}{{\HH\mathbf{P}^n}}
\newcommand{\afn}{{\mathbb{A}^n}}
\newcommand{\afx}[1]{\mathbb{A}^{#1}}
\newcommand{\ppn}{{\mathbb{P}^n}}
\newcommand{\ppx}[1]{\mathbb{P}^{#1}}

% math typography
\newcommand{\fa}{\;\;\forall}
\newcommand{\ul}[1]{\,\underline{#1}\,}
\newcommand{\xs}{{x_1,\dots,x_n}}
\newcommand{\xso}{{x_0,\dots,x_n}}
\newcommand{\nn}[2]{{{#1}_1,\dots,{#1}_{#2}}}
\newcommand{\nno}[2]{{{#1}_0,\dots,{#1}_{#2}}}
\newcommand{\nns}[3]{{{#1}_1\,{#2}\,\dots\,{#2}\,{#1}_{#3}}}
\newcommand{\nnso}[3]{{{#1}_0\,{#2}\,\dots\,{#2}\,{#1}_{#3}}}
\newcommand{\cb}[1]{\{#1\}}
\newcommand{\localize}[1]{\big[\textstyle\frac{1}{#1}\big]}
\newcommand{\invf}[1]{\frac{1}{#1}}
\newcommand{\inv}{{-1}}

\renewcommand{\geq}{\geqslant}
\renewcommand{\leq}{\leqslant}

\let\oldemptyset\emptyset
\let\emptyset\varnothing
\renewcommand{\ring}{\mathring}
\let\tbf\textbf
\let\tit\textit
\let\mrm\mathrm
\let\nf\normalfont
\let\ol\overline
\let\til\tilde
\let\sm\smallsetminus
\let\ssim\approx
\let\de\partial

\let\xto\xrightarrow
\let\hto\hookrightarrow
\let\xhto\xhookrightarrow
\let\onto\twoheadrightarrow
\let\xonto\xtwoheadrightarrow
\let\into\hookrightarrow
\let\xinto\xhookrightarrow

%\renewcommand{\ni}{{n-1}} % overrides \ni
%\newcommand{\cont}{\reflectbox{$\in$}}
\newcommand{\nii}{{n-1}}
\newcommand{\mi}{{m-1}}
\newcommand{\ki}{{k-1}}

% topology
\newcommand{\pin}{\pi_n(X,x_0)}
\newcommand{\pini}{\pi_n(X,x_0)}
\newcommand{\pinr}{\pi_n(X,A,x_0)}
\newcommand{\pinir}{\pi_\nii(X,A,x_0)}
\newcommand{\hn}{H_n(X;\Z)}
\newcommand{\hni}{H_\nii(X;\Z)}
\newcommand{\hnr}{H_n(X,A;\Z)}
\newcommand{\hnir}{H_\nii(X,A;\Z)}
\newcommand{\dn}{D^n}
\newcommand{\dni}{D^\nii}
\newcommand{\sn}{S^n}
\newcommand{\sni}{S^\nii}
\newcommand{\sph}{(D^n,\de D^n)}
\newcommand{\sphi}{(D^\nii,\de D^\nii)}
\newcommand{\pair}{(I^n,\de I^n)}
\newcommand{\pairs}{(X,A)}
\newcommand{\triple}{(I^n,\de I^n,J^\ni)}
\newcommand{\triples}{(X,A,x_0)}
\newcommand{\ns}{\Delta^n}
\newcommand{\ms}{\Delta^m}
\newcommand{\tsx}[1]{\Delta^{#1}}
\newcommand{\sx}[1]{\Delta_{#1}}
\DeclareMathOperator{\tel}{tel}
\DeclareMathOperator{\homeo}{Homeo}
\DeclareMathOperator{\diffeo}{Diffeo}
\DeclareMathOperator{\Ho}{Ho}
\newcommand{\simpl}{{\operatorname{simpl}}}
\newcommand{\sing}{{\operatorname{sing}}}
\newcommand{\core}{\operatorname{Core}}
\newcommand{\smsh}{\wedge}

% algebraic geometry
\newcommand{\qcoh}{quasi-coherent\ }
\newcommand{\qc}{quasi-compact\ }
\newcommand{\qs}{quasi-separated\ }
\newcommand{\ox}{{\O_X}}

% analysis
\newcommand{\dmu}{\mathop{}\!d}

% operators
\DeclareMathOperator{\id}{id}
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\Spec}{Spec}
\DeclareMathOperator{\pr}{pr}
\DeclareMathOperator{\incl}{incl}
\DeclareMathOperator{\ev}{ev}
\DeclareMathOperator{\Fun}{Fun}
\DeclareMathOperator{\ob}{ob}
\DeclareMathOperator{\weq}{\,\!weq}
\DeclareMathOperator{\map}{map}
\DeclareMathOperator{\coker}{coker}
\DeclareMathOperator{\rad}{rad}
\DeclareMathOperator{\const}{const}
\DeclareMathOperator{\Nil}{Nil}
\newcommand{\red}{\operatorname{red}}
\DeclareMathOperator{\Mod}{Mod}
\newcommand{\Aut}{\operatorname{Aut}}
\newcommand{\Mor}{\operatorname{Mor}}
\newcommand{\Hom}{\operatorname{Hom}}
\newcommand{\Hhom}{\operatorname{\underline{Hom}}}
\newcommand{\codim}{\operatorname{codim}}
\newcommand{\Eext}{\mathop{\Ee xt}\nolimits}
\DeclareMathOperator{\GL}{GL}
\DeclareMathOperator{\Frac}{Frac}
\DeclareMathOperator{\Pic}{Pic}
\DeclareMathOperator{\Div}{Div}
\renewcommand{\det}{\operatorname{det}}%otherwise, det_K behaves strangely in displaymode
\DeclareMathOperator{\Mat}{Mat}
\DeclareMathOperator{\Tr}{Tr}
\DeclareMathOperator{\rk}{rk}
\newcommand{\trdeg}{\operatorname{tr.deg}}
\newcommand{\idim}{\operatorname{inj.dim}}
\newcommand{\pdim}{\operatorname{pr.dim}}
\newcommand{\gdim}{\operatorname{gl.dim}}
\newcommand{\fdim}{\operatorname{fl.dim}}
\DeclareMathOperator{\Tor}{Tor}
\DeclareMathOperator{\Ext}{Ext}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\Span}{Span}

% aaargh
\newcommand{\IDelta}{
	\mathchoice{\Delta\llap{\scalebox{0.775}{$\Delta$\hspace{0.025em}}}}%
	{\Delta\llap{\scalebox{0.775}{$\Delta$\hspace{0.025em}}}}%
	{\Delta\llap{\scalebox{0.775}{$\scriptstyle\Delta$\hspace{0.025em}}}}%
	{\Delta\llap{\scalebox{0.775}{$\scriptscriptstyle\Delta$\hspace{0.025em}}}}
	}%{\boldsymbol{\Delta}}
\newcommand{\IGamma}{%
	\mathchoice{\raisebox{\depth}{\scalebox{1}[-1]{$\mathbb L$}}}%
	{\raisebox{\depth}{\scalebox{1}[-1]{$\mathbb L$}}}%
	{\raisebox{\depth}{\scalebox{1}[-1]{$\scriptstyle\mathbb L$}}}%
	{\raisebox{\depth}{\scalebox{1}[-1]{$\scriptscriptstyle\mathbb L$}}}
	}

% categories
\newcommand{\cat}[1]{{\normalfont\textup{#1}}}
\newcommand{\Cat}{\cat{Cat}}
\newcommand{\Set}{\cat{Set}}
\newcommand{\sSet}{\cat{sSet}}
\newcommand{\Kan}{\cat{Kan}}
\newcommand{\Ab}{\cat{Ab}}
\newcommand{\Grp}{\cat{Grp}}
\newcommand{\Grpd}{\cat{Grpd}}
\newcommand{\Ring}{\cat{Ring}}
\newcommand{\Alg}{\cat{Alg}}
\newcommand{\Top}{\cat{Top}}
\newcommand{\Op}{\cat{Op}}
\newcommand{\An}{\cat{An}}
\newcommand{\Sh}{\cat{Sh}}
\newcommand{\Shx}[1]{\cat{Sh}_{#1}}
\newcommand{\PSh}{\cat{PSh}}
\newcommand{\Pshx}[1]{\cat{PSh}_{#1}}
\newcommand{\Sch}{\cat{Sch}}
\newcommand{\affSch}{{\cat{affSch}}}
\DeclareMathOperator*{\colim}{colim}
\DeclareMathOperator*{\hocolim}{hocolim}
\DeclareMathOperator*{\holim}{holim}
\DeclareMathOperator{\Global}{\Gamma}
\DeclareMathOperator{\Nat}{Nat}


%%%% fancy arrows %%%%

\newlength{\arrowlength}
\settowidth{\arrowlength}{$\rightarrow$}
\newlength{\longarrowlength}
\settowidth{\longarrowlength}{$\longrightarrow$}

%\IsArgEmpty is already defined in style.sty
%\newcommand{\IsArgEmpty}[3]{%
%	\if\relax\detokenize{#1}\relax%
%	#2%
%	\else%
%	#3%
%	\fi}

\DeclareRobustCommand\longtwoheadrightarrow
{\relbar\joinrel\twoheadrightarrow}
\DeclareRobustCommand\longtwoheadleftarrow
{\twoheadleftarrow\joinrel\relbar}

\newcommand{\morphism}[1][]{%
	\mathchoice{\overset{#1}{\longrightarrow}}%
	{\IsArgEmpty{#1}{\rightarrow}{\overset{#1}{\longrightarrow}}}%
	{\IsArgEmpty{#1}{\rightarrow}{\overset{#1}{\longrightarrow}}}%
	{\IsArgEmpty{#1}{\rightarrow}{\overset{#1}{\longrightarrow}}}%
}

\newcommand{\lmorphism}[1][]{%
	\mathchoice{\overset{#1}{\longleftarrow}}%
	{\IsArgEmpty{#1}{\leftarrow}{\overset{#1}{\longleftarrow}}}%
	{\IsArgEmpty{#1}{\leftarrow}{\overset{#1}{\longleftarrow}}}%
	{\IsArgEmpty{#1}{\leftarrow}{\overset{#1}{\longleftarrow}}}%
}

\newcommand{\lrmorphism}[1][]{%
	\mathchoice{\overset{#1}{\longleftrightarrow}}%
	{\IsArgEmpty{#1}{\leftrightarrow}{\overset{#1}{\longleftrightarrow}}}%
	{\IsArgEmpty{#1}{\leftrightarrow}{\overset{#1}{\longleftrightarrow}}}%
	{\IsArgEmpty{#1}{\leftrightarrow}{\overset{#1}{\longleftrightarrow}}}%
}

\newcommand{\monomorphism}[1][]{%
	\mathchoice{\overset{#1}{\mathrel{\smash{\longhookrightarrow}\vphantom{\rightarrow}}}}%
	{\IsArgEmpty{#1}{\hookrightarrow}{\overset{#1}{\mathrel{\smash{\longhookrightarrow}\vphantom{\rightarrow}}}}}%
	{\IsArgEmpty{#1}{\hookrightarrow}{\overset{#1}{\mathrel{\smash{\longhookrightarrow}\vphantom{\rightarrow}}}}}%
	{\IsArgEmpty{#1}{\hookrightarrow}{\overset{#1}{\mathrel{\smash{\longhookrightarrow}\vphantom{\rightarrow}}}}}%
}

\newcommand{\lmonomorphism}[1][]{%
	\mathchoice{\overset{#1}{\mathrel{\smash{\longhookleftarrow}\vphantom{\rightarrow}}}}%
	{\IsArgEmpty{#1}{\hookleftarrow}{\overset{#1}{\mathrel{\smash{\longhookleftarrow}\vphantom{\rightarrow}}}}}%
	{\IsArgEmpty{#1}{\hookleftarrow}{\overset{#1}{\mathrel{\smash{\longhookleftarrow}\vphantom{\rightarrow}}}}}%
	{\IsArgEmpty{#1}{\hookleftarrow}{\overset{#1}{\mathrel{\smash{\longhookleftarrow}\vphantom{\rightarrow}}}}}%
}

\newcommand{\epimorphism}[1][]{%
	\mathchoice{\overset{#1}{\mathrel{\smash{\longtwoheadrightarrow}\vphantom{\rightarrow}}}}%
	{\IsArgEmpty{#1}{\twoheadrightarrow}{\overset{#1}{\mathrel{\smash{\longtwoheadrightarrow}\vphantom{\rightarrow}}}}}%
	{\IsArgEmpty{#1}{\twoheadrightarrow}{\overset{#1}{\mathrel{\smash{\longtwoheadrightarrow}\vphantom{\rightarrow}}}}}%
	{\IsArgEmpty{#1}{\twoheadrightarrow}{\overset{#1}{\mathrel{\smash{\longtwoheadrightarrow}\vphantom{\rightarrow}}}}}%
}
\newcommand{\lepimorphism}[1][]{%
	\mathchoice{\overset{#1}{\mathrel{\smash{\longtwoheadleftarrow}\vphantom{\rightarrow}}}}%
	{\IsArgEmpty{#1}{\twoheadleftarrow}{\overset{#1}{\mathrel{\smash{\longtwoheadleftarrow}\vphantom{\rightarrow}}}}}%
	{\IsArgEmpty{#1}{\twoheadleftarrow}{\overset{#1}{\mathrel{\smash{\longtwoheadleftarrow}\vphantom{\rightarrow}}}}}%
	{\IsArgEmpty{#1}{\twoheadleftarrow}{\overset{#1}{\mathrel{\smash{\longtwoheadleftarrow}\vphantom{\rightarrow}}}}}%
}

\newlength{\morphismlength}
\settowidth{\morphismlength}{$\longrightarrow$}

\newcommand{\ActsOn}[2]{\begin{tikzcd}[cramped]
		#1\ar[from=1-1,to=1-1,start anchor=-10, end anchor=10,bend right=125,looseness=7,"#2"']
\end{tikzcd}}

%somewhat ugly
\NewDocumentCommand{\doublemorphism}{O{} O{}}{%
	\begin{tikzcd}[ampersand replacement=\&, cramped, column sep={\the\morphismlength-0.04em}]%
	\vphantom{x}\rar[shift left=0.45ex, "#1"]\rar[shift right=0.45ex, "#2"{swap}] \& \vphantom{x}%
	\end{tikzcd}%
}

%somewhat ugly
\NewDocumentCommand{\doublelrmorphism}{O{} O{}}{%
	\begin{tikzcd}[ampersand replacement=\&, cramped, column sep={\the\morphismlength-0.04em}]%
	\vphantom{x}\rar[shift left=0.45ex, "#1"]\& \lar[shift left=0.45ex, "#2"] \vphantom{x}%
	\end{tikzcd}%
}

%somewhat ugly
\NewDocumentCommand{\doublerlmorphism}{O{} O{}}{%
	\begin{tikzcd}[ampersand replacement=\&, cramped, column sep={\the\morphismlength-0.04em}]%
		\vphantom{x}\rar[shift right=0.45ex, "#1"{swap}]\& \lar[shift right=0.45ex, "#2"{swap}] \vphantom{x}%
	\end{tikzcd}%
}

\newlength{\shortmorphismlength}
\settowidth{\shortmorphismlength}{$\rightarrow$}

\newcommand{\shortdoublemorphism}{%
	\begin{tikzcd}[ampersand replacement=\&, cramped, column sep={\the\shortmorphismlength-0.04em}]%
		\vphantom{x}\rar[shift left=0.45ex]\rar[shift right=0.45ex] \& \vphantom{x}%
	\end{tikzcd}%
}

%somewhat ugly
\newcommand{\shortdoublelrmorphism}{%
	\begin{tikzcd}[ampersand replacement=\&, cramped, column sep={\the\shortmorphismlength-0.04em}]%
		\vphantom{x}\rar[shift left=0.45ex]\& \lar[shift left=0.45ex] \vphantom{x}%
	\end{tikzcd}%
}

%ugly
%\newcommand{\doublelrmorphism}{\mathrel{\substack{\textstyle\longrightarrow\\[-0.67ex]\textstyle\longleftarrow}}}

%\colon in opposite direction, e.g. for adjunctions
\newcommand*\noloc{%
	\nobreak
	\mskip6mu plus1mu
	\mathpunct{}%
	\nonscript
	\mkern-\thinmuskip
	{:}%
	\mskip2mu
	\relax
}

\newcommand{\isomorphism}{\overset{\smash{\raisebox{-0.2ex}{$\scriptstyle\sim$}}}{\longrightarrow}}
\newcommand{\lisomorphism}{\overset{\smash{\raisebox{-0.2ex}{$\scriptstyle\sim$}}}{\longleftarrow}}
\newcommand{\lrisomorphism}{\overset{\smash{\raisebox{-0.2ex}{$\scriptstyle\sim$}}}{\longleftrightarrow}}

\newcommand{\converge}{%
	\mathchoice{\Longrightarrow}%
	{\Rightarrow}%
	{\Rightarrow}%
	{\Rightarrow}%
}

\newcommand{\lconverge}{%
	\mathchoice{\Longleftarrow}%
	{\Leftarrow}%
	{\Leftarrow}%
	{\Leftarrow}%
}

\tikzset{double line with arrow/.style args={#1,#2}{decorate,decoration={markings,%
mark=at position 0 with {\coordinate (ta-base-1) at (0,1pt);
\coordinate (ta-base-2) at (0,-1pt);},
mark=at position 1 with {\draw[#1] (ta-base-1) -- (0,1pt);
\draw[#2] (ta-base-2) -- (0,-1pt);
}}}}

\tikzset{eq/.style={-,double line with arrow={-,-}}}


%%%% tikz-cd convenience %%%%

\tikzcdset{
	arrow style=tikz, 
	diagrams={>=to, line cap=round, line width=rule_thickness}, arrows={line width=rule_thickness}
}

\newcommand{\pullbacksign}{\hspace{-0.325ex}\tikz[baseline=(pb.base)]{\draw[line width=rule_thickness, line cap=round] (0,0) ++ (-0.75ex,-0.75ex) -- ++(1.5ex,0ex) -- ++ (0ex,1.5ex);\node at (-0.6ex,0.6ex) {.};\node (pb) at (0,0) {\phantom{x}};}}

\newcommand{\pushoutsign}{\hspace{0.2ex}\tikz[baseline=(po.base)]{\draw (0,0) ++ (-0.75ex,-0.75ex) -- ++(0ex,1.5ex) -- ++ (1.5ex,0ex);\node at (0.6ex,-0.6ex) {.};\node (po) at (0,0) {\phantom{x}};}}

\tikzcdset{
	pullback/.style = {dash, phantom, "\vphantom{x}\smash{\pullbacksign}", start anchor=center, end anchor=center},
	hpullback/.style = {dash, phantom, "\vphantom{x}\smash{\pullbacksign_{h}}", start anchor=center, end anchor=center},
	pushout/.style = {dash, phantom, "\vphantom{x}\smash{\pushoutsign}", start anchor=center, end anchor=center}
}

\tikzcdset{
	eqtop/.style={dash, shift right=#1},
	eqtop/.default={0.1em},
	eqbot/.style={dash, shift left=#1},
	eqbot/.default={0.1em}
}
\newcommand{\eqar}[1][]{\ar[#1,eqtop]\ar[#1,eqbot]}

\tikzcdset{
	mono/.style={#1 hook->},
	mono/.default={right},
	epi/.style={->>},
	iso/.style={"\sim"{sloped, above}}
}

\tikzcdset{
	longarrowwidth/.style={column sep={\the\longarrowlength}},
	arrowwidth/.style={column sep={\the\arrowlength}}
}

\tikzset{
	symbol/.style={
		draw=none,
		every to/.append style={
			edge node={node [sloped, allow upside down, auto=false]{$#1$}}}
	}
}


%%%% modifiers %%%%
\newcommand{\ov}[1]{\overline{#1}\vphantom{#1}}
\newcommand{\hacek}[1]{\check{#1}\hspace{0.06125em}}

\DeclareMathSymbol{\widehatsym}{\mathord}{largesymbols}{"62}
\newcommand\lowerwidehatsym{%
	\text{\smash{\raisebox{-1.3ex}{%
				$\widehatsym$}}}}
\newcommand\fixwidehat[1]{\accentset{\displaystyle\lowerwidehatsym}{#1}}%

\DeclareMathSymbol{\widetildesym}{\mathord}{largesymbols}{"65}
\newcommand\lowerwidetildesym{%
	\text{\smash{\raisebox{-1.3ex}{%
				$\widetildesym$}}}}
\newcommand\fixwidetilde[1]{\accentset{\displaystyle\lowerwidetildesym}{#1}}

\newcommand{\snake}[1]{\fixwidetilde{#1}}%space adjusting hack
\newcommand{\roof}[1]{\fixwidehat{#1}\vphantom{\widehat{\Oo}}}
\newcommand{\roofmm}{\fixwidehat{\mm}\vphantom{\fixwidehat{\Oo}}}
\newcommand{\complete}{\lowerwidehatsym}
\newcommand{\qcmod}{\lowerwidetildesym}
\newcommand{\cotimes}{\mathbin{\roof{\otimes}}}


%%%% miscellaneous %%%%
\newcommand{\blank}{\phantom{w}}
\newcommand{\defemph}[1]{\emph{#1}}%{\textbf{\upshape#1}} %emphasize style of a to-be-defined object in a definition
\mathchardef\mhyph="2D